<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Intro to download economic data in R</title>
  <meta name="description" content="">
  <meta name="author" content="Irina Goloshchapova - Senior Expert in CMASF">
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="stylesheet" href="./frameworks/revealjs/css/reveal.min.css">
  <link rel="stylesheet" href="./frameworks/revealjs/css/theme/solarized.css" id="theme">
  <link rel="stylesheet" href="./highlighters/highlight.js/css/zenburn.css" id="theme">
  <!--[if lt IE 9]>
  <script src="lib/js/html5shiv.js"></script>
  <![endif]-->  <link rel="stylesheet" href = "assets/css/ribbons.css">

</head>
<body>
  <div class="reveal">
    <div class="slides">
      <section class='' data-state='' id='slide-1'>
  <h1>Intro to download economic data in R</h1>
  <p>Irina Goloshchapova<br>
Center for Macroeconomic Analysis and Short-Term Forecasting<br>
Open Data Science</p>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

</section>
<section>
   <section class='' data-state=''>
    <h2>Plan</h2>
    <ul>
<li><p>Why we want to automate the download data process  </p></li>
<li><p>What we should use in R if we want download open economic data  </p></li>
<li><p>How we should use it </p></li>
</ul>

    <aside class='notes'>
      
    </aside>
   </section>
   <section class='' data-state=''>
    <h2>Plan</h2>

<p>One thing first!  </p>

<p>Please, open the presentation in local PCs!</p>

<p><a href="http://irinagoloshchapova.github.io/Progs/OpenData_March_2017/">http://irinagoloshchapova.github.io/Progs/OpenData_March_2017/</a>  </p>

    <aside class='notes'>
      
    </aside>
   </section>
</section>
<section>
   <section class='' data-state=''>
    <h2>Why automate</h2>
    
    <aside class='notes'>
      
    </aside>
   </section>
   <section class='' data-state=''>
    <h2>Why automate</h2>

<ul>
<li>Frequent need to quickly access the data: regular monitoring, dashboard<br></li>
<li>Complex computations with data to obtain final dataset<br></li>
<li>You need big data<br></li>
<li>Database structure in your pocket </li>
</ul>

    <aside class='notes'>
      
    </aside>
   </section>
</section>
<section>
   <section class='' data-state=''>
    <h2>What we should use</h2>
    
    <aside class='notes'>
      
    </aside>
   </section>
   <section class='' data-state=''>
    <h2>What we should use</h2>

<ul>
<li>R Packages<br></li>
<li>Self connection functions to API<br></li>
</ul>

    <aside class='notes'>
      
    </aside>
   </section>
</section>
<section>
   <section class='' data-state=''>
    <h2>How to use: R packages</h2>
    
    <aside class='notes'>
      
    </aside>
   </section>
   <section class='' data-state=''>
    <h2>How to use: R Packages</h2>

<p>Firstly: <a href="http://bfy.tw/AJQ6">Google it!</a></p>

<p><img src="assets/img/lazy_cat.gif" alt="cat_lazy_google"></p>

    <aside class='notes'>
      
    </aside>
   </section>
   <section class='' data-state=''>
    <h2>How to use: R Packages</h2>

<ul>
<li><p><strong>World Bank</strong>: <a href="https://github.com/vincentarelbundock/WDI">WDI</a>, <a href="https://github.com/GIST-ORNL/wbstats">wbstats</a>  </p></li>
<li><p><strong>International Monetary Fund</strong>: <a href="https://github.com/mingjerli/IMFData">IMFData</a>, <a href="https://github.com/christophergandrud/imfr">imfr</a> </p></li>
</ul>

    <aside class='notes'>
      
    </aside>
   </section>
   <section class='' data-state=''>
    <h2>How to use: R Packages</h2>

<h3>Key principles</h3>

<ul>
<li><p><strong>Read materials and choose package</strong>: CRAN, <em>GitHub</em>  </p></li>
<li><p><strong>Undestand searching and downloading structure in the chosen package</strong>: Tutorials  </p></li>
<li><p><strong>Try simple example</strong>: GitHub, R-Bloggers, Google  </p></li>
<li><p><strong>Download what do you need</strong>: R  </p></li>
</ul>

    <aside class='notes'>
      
    </aside>
   </section>
   <section class='' data-state=''>
    <h2>How to use: R Packages</h2>

<h3>Prerequisites</h3>

<pre><code class="r">install.packages(c(&#39;devtools&#39;, &#39;tidyverse&#39;, &#39;ggthemes&#39;, &#39;httr&#39;, &#39;jsonlite&#39;))

devtools::install_github(&quot;vincentarelbundock/WDI&quot;)
devtools::install_github(&quot;GIST-ORNL/wbstats&quot;)
devtools::install_github(&#39;mingjerli/IMFData&#39;)
devtools::install_github(&#39;christophergandrud/imfr&#39;)
</code></pre>

    <aside class='notes'>
      
    </aside>
   </section>
   <section class='' data-state=''>
    <h2>How to use: R Packages</h2>

<h3>Example: World Bank</h3>

<p><strong>Read materials and choose package</strong></p>

<p><a href="https://github.com/vincentarelbundock/WDI">WDI</a> <strong><em>or</em></strong> <a href="https://github.com/GIST-ORNL/wbstats">wbstats</a></p>

    <aside class='notes'>
      
    </aside>
   </section>
   <section class='' data-state=''>
    <h2>How to use: R Packages</h2>

<h3>Example: World Bank</h3>

<iframe src='https://cran.r-project.org/web/packages/wbstats/vignettes/Using_the_wbstats_package.html' width = '960px' height = '600px'></iframe>

    <aside class='notes'>
      
    </aside>
   </section>
   <section class='' data-state=''>
    <h2>How to use: R Packages</h2>

<h3>Example: World Bank</h3>

<p><strong>Undestand searching and downloading structure in the chosen package</strong>  </p>

<ul>
<li><p>install package  </p></li>
<li><p>search needed indicators codes  </p></li>
<li><p>define sample of countries  </p></li>
<li><p>define period of time  </p></li>
<li><p>define final data format  </p></li>
<li><p>download</p></li>
</ul>

    <aside class='notes'>
      
    </aside>
   </section>
   <section class='' data-state=''>
    <h2>How to use: R Packages</h2>

<h3>Example: World Bank</h3>

<p><strong>Try simple example</strong>  </p>

<pre><code class="r">library(wbstats)
library(ggplot2)

oil_data &lt;- wb(indicator = c(&quot;CRUDE_DUBAI&quot;, &quot;CRUDE_BRENT&quot;, &quot;CRUDE_WTI&quot;, &quot;CRUDE_PETRO&quot;),
               startdate = &quot;2012M01&quot;, enddate = &quot;2014M12&quot;, freq = &quot;M&quot;, POSIXct = TRUE)

ggplot(oil_data, aes(x = date_ct, y = value, colour = indicator)) + geom_line(size = 1) +
  labs(title = &quot;Crude Oil Price Comparisons&quot;, x = &quot;Date&quot;, y = &quot;US Dollars&quot;)
</code></pre>

    <aside class='notes'>
      
    </aside>
   </section>
   <section class='' data-state=''>
    <h2>How to use: R Packages</h2>

<h3>Example: World Bank</h3>

<p><strong>Download what do you need</strong>  </p>

<pre><code class="r">library(wbstats)
library(ggplot2)
library(ggthemes)

wbsearch(pattern = &quot;inflation&quot;, fields = &quot;indicator&quot;, extra = TRUE)

#             indicatorID                             indicator
# 8294  NY.GDP.DEFL.KD.ZG    Inflation, GDP deflator (annual %)
# 10895    FP.CPI.TOTL.ZG Inflation, consumer prices (annual %)

deflator &lt;- wb(indicator = &quot;NY.GDP.DEFL.KD.ZG&quot;, country = &quot;RU&quot;, mrv = 16, freq = &quot;Y&quot;, POSIXct = TRUE)
CPI &lt;- wb(indicator = &quot;FP.CPI.TOTL.ZG&quot;, country = &quot;RU&quot;, mrv = 16, freq = &quot;Y&quot;, POSIXct = TRUE)

inflation_data &lt;- rbind(deflator, CPI)

g &lt;- ggplot(inflation_data, aes(x = date_ct, y = value, colour = indicator)) + geom_line(size = 1)
g &lt;- g + labs(title = &quot;Inflation data&quot;, x = NULL, y = NULL)
g &lt;- g + guides(colour = guide_legend(title = &#39;&#39;, size = 3.5))
g &lt;- g + theme_solarized()
g &lt;- g + scale_colour_solarized()
g &lt;- g + theme(legend.position = &#39;top&#39;)
g
</code></pre>

    <aside class='notes'>
      
    </aside>
   </section>
   <section class='' data-state=''>
    <h2>How to use: R Packages</h2>

<h3>Example: World Bank</h3>

<p><strong>Visualize results</strong> </p>

<p><img src="assets/img/wbstats_inflation.png" alt="inflation_wb_results"></p>

    <aside class='notes'>
      
    </aside>
   </section>
   <section class='' data-state=''>
    <h2>How to use: R Packages</h2>

<h3>Example: International Monetary Fund</h3>

<p><strong>Read materials and choose package</strong></p>

<p><a href="https://github.com/mingjerli/IMFData">IMFData</a> <strong><em>or</em></strong> <a href="https://github.com/christophergandrud/imfr">imfr</a></p>

    <aside class='notes'>
      
    </aside>
   </section>
   <section class='' data-state=''>
    <h2>How to use: R Packages</h2>

<h3>Example: International Monetary Fund</h3>

<iframe src='https://cran.r-project.org/web/packages/IMFData/README.html' width = '960px' height = '600px'></iframe>

    <aside class='notes'>
      
    </aside>
   </section>
   <section class='' data-state=''>
    <h2>How to use: R Packages</h2>

<h3>Example: International Monetary Fund</h3>

<p><strong>Undestand searching and downloading structure in the chosen package</strong>  </p>

<ul>
<li><p>install package  </p></li>
<li><p>choose database ID</p></li>
<li><p>define database dimensions and their codes</p></li>
<li><p>search needed indicators codes  </p></li>
<li><p>define sample of countries  </p></li>
<li><p>define period of time  </p></li>
<li><p>define final data format  </p></li>
<li><p>download</p></li>
</ul>

    <aside class='notes'>
      
    </aside>
   </section>
   <section class='' data-state=''>
    <h2>How to use: R Packages</h2>

<h3>Example: International Monetary Fund</h3>

<p><strong>Try simple example</strong>  </p>

<pre><code class="r">library(IMFData)

databaseID &lt;- &quot;IFS&quot;
startdate = &quot;2001-01-01&quot;
enddate = &quot;2016-12-31&quot;
checkquery = FALSE

## Germany, Norminal GDP in Euros, Norminal GDP in National Currency
queryfilter &lt;- list(CL_FREQ = &quot;&quot;, CL_AREA_IFS = &quot;GR&quot;, CL_INDICATOR_IFS = c(&quot;NGDP_EUR&quot;, 
    &quot;NGDP_XDC&quot;))

GR.NGDP.query &lt;- CompactDataMethod(databaseID, queryfilter, startdate, enddate, 
    checkquery)

GR.NGDP.query$Obs[[1]][1:5, ]
#   @TIME_PERIOD @OBS_VALUE
# 1      2001-Q1    35.2366
# 2      2001-Q2    36.7264
# 3      2001-Q3    39.8428
# 4      2001-Q4    40.3881
# 5      2002-Q1    37.4971
</code></pre>

    <aside class='notes'>
      
    </aside>
   </section>
   <section class='' data-state=''>
    <h2>How to use: R Packages</h2>

<h3>Example: International Monetary Fund</h3>

<p><strong>Download what do you need</strong>  </p>

<pre><code class="r">library(IMFData)
library(ggplot2)

availableDB$DatabaseID
# FSI
# &quot;Financial Soundness Indicators (FSI)&quot; 
FSI.available.codes &lt;- DataStructureMethod(&quot;FSI&quot;)
names(FSI.available.codes)
# [1] &quot;CL_FREQ&quot;          &quot;CL_AREA_FSI&quot;      &quot;CL_INDICATOR_FSI&quot;

CodeSearch(FSI.available.codes, &quot;CL_INDICATOR_FSI&quot;, &quot;stability&quot;)
CodeSearch(FSI.available.codes, &quot;CL_INDICATOR_FSI&quot;, &quot;Debt&quot;)
# FSHG_PT
# Financial Soundness Indicators, Encouraged Set, Households, Household Debt to Gross Domestic Product (GDP), Percent

databaseID &lt;- &quot;FSI&quot;
startdate = &quot;2000-01-01&quot;
enddate = &quot;2016-12-31&quot;
checkquery = FALSE

queryfilter &lt;- list(CL_FREQ = &quot;&quot;, CL_AREA_FSI = &quot;RU&quot;, CL_INDICATOR_FSI = &quot;FSHG_PT&quot;)
indicator_query &lt;- CompactDataMethod(databaseID, queryfilter, startdate, enddate, checkquery)
indicator_query$Obs[[1]]
</code></pre>

    <aside class='notes'>
      
    </aside>
   </section>
   <section class='' data-state=''>
    <h2>How to use: R Packages</h2>

<h3>Example: World Bank</h3>

<p><strong>Visualize results</strong> </p>

<p><img src="assets/img/hous_debt.png" alt="fsi_results"></p>

    <aside class='notes'>
      
    </aside>
   </section>
</section>
<section>
   <section class='' data-state=''>
    <h2>How to use: API connection</h2>
    
    <aside class='notes'>
      
    </aside>
   </section>
   <section class='' data-state=''>
    <h2>How to use: API connection</h2>

<p>Firstly: <a href="https://ru.wikipedia.org/wiki/API">Read API documentation!</a></p>

<p><img src="assets/img/spongebob.gif" alt="cat_lazy_google">  </p>

    <aside class='notes'>
      
    </aside>
   </section>
   <section class='' data-state=''>
    <h2>How to use: API connection</h2>

<h3>Key principles</h3>

<ul>
<li><p><strong>Read API documentation</strong>: official websites of stat resources  </p></li>
<li><p><strong>Undestand searching and downloading structure of API</strong>: things hided in R libraries  </p></li>
<li><p><strong>Generate code to download simple piece of data</strong>: download almost anything - at least once  </p></li>
<li><p><strong>Generalize code to download all what you need</strong>: functions to download, parameterisation for your purposes  </p></li>
</ul>

    <aside class='notes'>
      
    </aside>
   </section>
   <section class='' data-state=''>
    <h2>How to use: API connection</h2>

<h3>Example: World Bank</h3>

<p><a href="https://datahelpdesk.worldbank.org/knowledgebase/articles/889392-api-documentation">World Bank for Developers: API Documentation</a></p>

    <aside class='notes'>
      
    </aside>
   </section>
   <section class='' data-state=''>
    <h2>How to use: API connection</h2>

<h3>Example: World Bank</h3>

<p><strong>Undestand searching and downloading structure of API</strong>  </p>

<ul>
<li><p>what kind of API is it  </p></li>
<li><p>available formats to download </p>

<pre><code>format=json
</code></pre></li>
<li><p>get list of available countries </p>

<pre><code>http://api.worldbank.org/countries
</code></pre></li>
<li><p>get list of available indicators  </p>

<pre><code>http://api.worldbank.org/indicators
</code></pre></li>
<li><p>define time period  </p>

<pre><code>date=2000:2001; date=2009Q1:2010Q3; date=2009M01:2010M08
</code></pre></li>
</ul>

    <aside class='notes'>
      
    </aside>
   </section>
   <section class='' data-state=''>
    <h2>How to use: API connection</h2>

<h3>Example: World Bank</h3>

<p><strong>Undestand searching and downloading structure of API</strong>  </p>

<ul>
<li>understand link structure<br></li>
</ul>

<pre><code class="r"># url parameters
base_url &lt;- &#39;http://api.worldbank.org&#39;
countries &lt;- &#39;/countries/&#39;
indicators &lt;- &#39;/indicators/&#39;
date &lt;- &#39;?date=&#39;
per_page &lt;- &#39;&amp;per_page=20000&#39;
format &lt;- &#39;&amp;format=json&#39;

start_period &lt;- &#39;1950&#39;
end_period &lt;- &#39;2016&#39;

# building url for API call
paste0(base_url, countries, &lt;COUNTRIES_QUERY&gt;, indicators, &lt;INDICATOR_QUERY&gt;, date, start_period, &#39;:&#39;, end_period, per_page, format)
</code></pre>

    <aside class='notes'>
      
    </aside>
   </section>
   <section class='' data-state=''>
    <h2>How to use: API connection</h2>

<h3>Example: World Bank</h3>

<p><strong>Generate code to download simple piece of data</strong> </p>

<pre><code class="r">#  get list of countries 
## loading libraries
library(httr)
library(jsonlite)
library(tidyverse)
library(ggplot2)

## generate url 
url &lt;- &#39;http://api.worldbank.org/countries?format=json&amp;per_page=300&#39;

## get data
raw.result &lt;- GET(url)
names(raw.result)
this.content &lt;- fromJSON(rawToChar(raw.result$content))
str(this.content)
length(this.content)
View(this.content[[2]])
wb_countries &lt;- this.content[[2]]
</code></pre>

    <aside class='notes'>
      
    </aside>
   </section>
   <section class='' data-state=''>
    <h2>How to use: API connection</h2>

<h3>Example: World Bank</h3>

<p><strong>Generate code to download simple piece of data</strong> </p>

<pre><code class="r">#  get list of indicators
## generate url 
url &lt;- &#39;http://api.worldbank.org/indicators?format=json&amp;per_page=20000&#39;

## get data
raw.result &lt;- GET(url)
this.content &lt;- fromJSON(rawToChar(raw.result$content))
# str(this.content)
# length(this.content)
wb_indicators &lt;- this.content[[2]]

# view data
View(wb_indicators)
# Attention! Nested data.frame for topics!
</code></pre>

    <aside class='notes'>
      
    </aside>
   </section>
   <section class='' data-state=''>
    <h2>How to use: API connection</h2>

<h3>Example: World Bank</h3>

<p><strong>Generate code to download simple piece of data</strong> </p>

<pre><code class="r"># example query for one indicator
url &lt;- &#39;http://api.worldbank.org/countries/br;ru/indicators/SP.POP.TOTL?date=2013Q1:2015Q4&amp;format=json&#39;
raw.result &lt;- GET(url)

example_query &lt;- fromJSON(rawToChar(raw.result$content))
# str(example_query)
View(example_query[[2]])
</code></pre>

    <aside class='notes'>
      
    </aside>
   </section>
   <section class='' data-state=''>
    <h2>How to use: API connection</h2>

<h3>Example: World Bank</h3>

<p><strong>Generalize code to download all what you need</strong> </p>

<ul>
<li><p>saving tables with values for needed parameters</p></li>
<li><p>functions to download, useful for you  </p></li>
</ul>

    <aside class='notes'>
      
    </aside>
   </section>
   <section class='' data-state=''>
    <h2>How to use: API connection</h2>

<h3>Example: World Bank</h3>

<p><strong>Generalize code to download all what you need</strong> </p>

<pre><code class="r"># generalizing previous url building code for several indicators
queries &lt;- lapply(&lt;INPUT_CODES&gt;, FUN = function(x) paste0(base_url, countries, wb_countries_query, indicators, x, date, start_period, &#39;:&#39;, end_period, per_page, format))

# example of input codes
input_codes &lt;- c(&#39;i_acc_deposit_A1&#39;, &#39;GFDD.AI.25&#39;)
</code></pre>

    <aside class='notes'>
      
    </aside>
   </section>
   <section class='' data-state=''>
    <h2>How to use: API connection</h2>

<h3>Example: World Bank</h3>

<p><strong>Generalize code to download all what you need</strong> </p>

<pre><code class="r"># download_wb_function.R
# source(&#39;download_wb_function.R&#39;)

library(dplyr)
library(tidyr)
library(purrr)
library(lubridate)
library(httr)
library(jsonlite)
library(data.table)

options(stringsAsFactors = FALSE)

##--------------------------------------------------------------------------
## Functions: download and basic processing
##--------------------------------------------------------------------------
# try.error function
try.error &lt;- function(x)
{
  y = NA
  try_error = tryCatch(data.frame(x), error = function(e) e)
  if (!inherits(try_error, &quot;error&quot;))
    y = data.frame(x)
  return(y)
}

# download_WB function
download_WB &lt;- function(queries) {
  new_data_list &lt;- list()

  for (i in length(queries):1) {
    cat(&quot;Iteration = &quot;, iter &lt;- i, &quot;\n&quot;)
    this.query       &lt;- queries[[i]]
    this.raw.answer  &lt;- GET(this.query)
    this.content &lt;- fromJSON(rawToChar(this.raw.answer$content))
    new_data_list[[i]] &lt;- try.error(this.content[[2]])
    cat(ifelse(is.na(new_data_list[i]), &#39;False\n&#39;, &#39;True\n&#39;))

    if (!is.na(new_data_list[i])) {
      metadata &lt;- data.frame(Indicator_Id = new_data_list[[i]]$indicator$id, 
                             Indicator_Value = new_data_list[[i]]$indicator$value, 
                             Country_Id = new_data_list[[i]]$country$id, 
                             Country_Value = new_data_list[[i]]$country$value)
      new_data_list[[i]] &lt;- select(new_data_list[[i]], -c(indicator, country))
      new_data_list[[i]] &lt;- mutate(new_data_list[[i]], Indicator_Id = metadata$Indicator_Id, 
                                    Indicator_Value = metadata$Indicator_Value, 
                                    Country_Id = metadata$Country_Id, 
                                    Country_Value = metadata$Country_Value)
    }
    else {new_data_list[i] &lt;- NULL}

    Sys.sleep(time = 0.01)
  }

  new_data_df &lt;- rbindlist(new_data_list) 
  return(new_data_df)
}
## ----------------------------------------------------------------------
# new_data_df &lt;- download_WB(queries)
## ----------------------------------------------------------------------
</code></pre>

    <aside class='notes'>
      
    </aside>
   </section>
</section>
<section>
   <section class='' data-state=''>
    <h2>Contacts and collaboration</h2>
    <p>Irina Goloshchapova - @irina_g (<a href="http://ods.ai/">ods</a>), <a href="mailto:igoloshchapova@forecast.ru">igoloshchapova@forecast.ru</a>  </p>

<p><a href="https://www.meetup.com/rMoscow/">R Moscow Meetup</a>  </p>

<p><a href="https://www.meetup.com/Moscow-Data-Visualization-Meetup/">Data Visualization Meetup</a>  </p>

<iframe src='http://ods.ai/' width = '960px' height = '600px'></iframe>

    <aside class='notes'>
      
    </aside>
   </section>
</section>
    </div>
  </div>
</body>
  <script src="./frameworks/revealjs/lib/js/head.min.js"></script>
  <script src="./frameworks/revealjs/js/reveal.min.js"></script>
  <script>
  // Full list of configuration options available here:
  // https://github.com/hakimel/reveal.js#configuration
  Reveal.initialize({
    controls: true,
    progress: true,
    history: true,
    center: true,
    theme: Reveal.getQueryHash().theme || 'solarized', 
    transition: Reveal.getQueryHash().transition || 'none', 
    dependencies: [
    // Cross-browser shim that fully implements classList -
    // https://github.com/eligrey/classList.js/
      { src: './frameworks/revealjs/lib/js/classList.js', condition: function() { return !document.body.classList;}},
      // Zoom in and out with Alt+click
      { src: './frameworks/revealjs/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
      // Speaker notes
      { src: './frameworks/revealjs/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } },
      // Remote control your reveal.js presentation using a touch device
      //{ src: './frameworks/revealjs/plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
      ]
  });
  </script>  <!-- LOAD HIGHLIGHTER JS FILES -->
<script src="./highlighters/highlight.js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<!-- DONE LOADING HIGHLIGHTER JS FILES -->
 

</html>